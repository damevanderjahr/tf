apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: loki
  namespace: monitoring
spec:
  releaseName: loki
  chart:
    spec:
      chart: loki
      version: 5.7.1
      sourceRef:
        kind: HelmRepository
        name: grafana
        namespace: flux-system
  interval: 5m
  values:
    mode: SingleBinary
    loki:
      auth_enabled: false
      commonConfig:
        replication_factor: 1
      storage:
        type: 'filesystem'
      schemaConfig:
        configs:
        - from: "2020-07-31"
          store: tsdb
          index:
            prefix: loki_index_
            period: 24h
          object_store: filesystem # we're storing on filesystem so there's no real persistence here.
          schema: v11
    singleBinary:
      replicas: 1
    read:
      replicas: 0
    backend:
      replicas: 0
    write:
      replicas: 0
#   values:
#     config:
#       auth_enabled: false
#       common:
#         instance_addr: 127.0.0.1
#         path_prefix: /tmp/loki
#         storage:
#           filesystem:
#             chunks_directory: /tmp/loki/chunks
#             rules_directory: /tmp/loki/rules
#         replication_factor: 1
#         ring:
#           kvstore:
#             store: inmemory
#       query_range:
#         results_cache:
#           cache:
#             embedded_cache:
#               enabled: true
#               max_size_mb: 100
#       schema_config:
#         configs:
#           - from: 2020-10-24
#             store: boltdb-shipper
#             object_store: filesystem
#             schema: v11
#             index:
#               prefix: index_
#               period: 24h


# values:
  #   loki:
  #     config:
  #       auth_enabled: false
  #       server:
  #         http_listen_port: 3100
  #       ingester:
  #         lifecycler:
  #           address: 127.0.0.1
  #           ring:
  #             kvstore:
  #               store: inmemory
  #             replication_factor: 1
  #           final_sleep: 0s
  #         chunk_idle_period: 5m
  #         chunk_retain_period: 30s
  #         max_transfer_retries: 0
  #       schema_config:
  #         configs:
  #           - from: 2020-10-24
  #             store: boltdb-shipper
  #             object_store: filesystem
  #             schema: v11
  #             index:
  #               prefix: index_
  #               period: 24h
  #       storage_config:
  #         boltdb_shipper:
  #           active_index_directory: /loki/index
  #           cache_location: /loki/cache
  #           shared_store: filesystem
  #         filesystem:
  #           directory: /loki/chunks
  #       limits_config:
  #         enforce_metric_name: false
  #         reject_old_samples: true
  #         reject_old_samples_max_age: 24h
  #     persistence:
  #       enabled: true
  #       storageClassName: standard
  #       accessModes:
  #         - ReadWriteOnce
  #       size: 10Gi